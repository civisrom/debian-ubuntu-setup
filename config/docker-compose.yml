version: '3.8'

# RustDesk Server Docker Compose Configuration
#
# SECURITY WARNING:
# - The default encryption key "-k _" is INSECURE and should be changed!
# - Generate a strong key using: openssl rand -hex 16
# - Replace "_" in both hbbs and hbbr commands with your generated key
# - Keep the key secure and backed up
#
# NETWORK WARNING:
# - network_mode: "host" gives containers full access to host network
# - This is required for RustDesk to work properly with NAT traversal
# - Ensure your firewall (UFW) is properly configured
#
# RESTART POLICY:
# - Changed from "no" to "unless-stopped" for automatic recovery
# - Containers will restart on failure and after system reboot
# - To stop permanently, use: docker compose down

services:
  hbbs:
    container_name: hbbs
    image: rustdesk/rustdesk-server:latest
    # WARNING: Change the key "_" to a secure random value!
    # Generate with: openssl rand -hex 16
    command: hbbs -k _
    volumes:
      - ./data:/root
    # host mode required for NAT traversal
    network_mode: "host"
    depends_on:
      - hbbr
    restart: unless-stopped
    # Add resource limits to prevent abuse
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M

  hbbr:
    container_name: hbbr
    image: rustdesk/rustdesk-server:latest
    # WARNING: Change the key "_" to a secure random value!
    # Must be the SAME key as hbbs above
    command: hbbr -k _
    volumes:
      - ./data:/root
    # host mode required for NAT traversal
    network_mode: "host"
    restart: unless-stopped
    # Add resource limits to prevent abuse
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 256M
